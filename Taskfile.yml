version: '3'

tasks:
  generate:
    aliases:
      - gen
    desc: "Generate Go and Python code from proto files"
    cmds:
      - echo "ðŸš€ Generating protobuf code..."

      # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
      - python -c "import os; os.makedirs('./shared/gen/go', exist_ok=True); os.makedirs('./shared/gen/python', exist_ok=True)"

      # --------------------
      # Go code generation
      # --------------------
      - >
        protoc -I ./shared/protos/proto \
        ./shared/protos/proto/ocr/*.proto \
        --go_out=./shared/gen/go --go_opt=paths=source_relative \
        --go-grpc_out=./shared/gen/go --go-grpc_opt=paths=source_relative

      # --------------------
      # Python code generation
      # --------------------
      - python -m pip install --quiet --exists-action=i grpcio-tools
      - >
        python -m grpc_tools.protoc \
        -I ./shared/protos/proto \
        --python_out=./shared/gen/python \
        --grpc_python_out=./shared/gen/python \
        ./shared/protos/proto/ocr/*.proto

      - echo "âœ… Protobuf generation completed successfully."
